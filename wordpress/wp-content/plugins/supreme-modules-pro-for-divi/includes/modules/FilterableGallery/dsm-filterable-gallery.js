jQuery(function(t){t(document).ready(function(){let t=document.querySelectorAll(".dsm-filterable-gallery-container");t.forEach((t,e)=>{let a=t.dataset.use_lightbox,i=t.querySelector(".dsm-filterable-gallery-inner-container");"on"===a&&jQuery(i).magnificPopup({delegate:".dsm-filterable-gallery-item",type:"image",tLoading:"Loading image ",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{titleSrc:function(t){let e=t.el[0].dataset.lightbox_title,a=t.el[0].dataset.lightbox_caption,i=t.el[0].dataset.lightbox_description,r="";return r+=void 0===e||""===e?"":e.replace(/[^]/g,function(t){return"&#"+t.charCodeAt(0)+";"}),r+=void 0===a||""===a?"":"<small class='dsm-filterable-image-caption'>"+a.replace(/[^]/g,function(t){return"&#"+t.charCodeAt(0)+";"})+"</small>",r+=void 0===i||""===i?"":"<small class='dsm-filterableimage-description'>"+i.replace(/[^]/g,function(t){return"&#"+t.charCodeAt(0)+";"})+"</small>"}},allowHTMLInTemplate:!0})}),t.forEach(t=>{let e=t.querySelector(".dsm-filterable-gallery-inner-container"),a=t.querySelector(".dsm-gallery-loadmore-container"),i=t.querySelector(".dsm-gallery-number-pagination-container"),r=t.querySelectorAll(".dsm-filterable-gallery-filter-item"),n=Number(t.dataset.per_page),l="on"===t.dataset.showpagination,s=t.dataset.paginationtype,d=Number(t.dataset.speed),c=i&&"on"===i.dataset.tidyPagination,o=new Shuffle(e,{itemSelector:".dsm-filterable-gallery-item",delimiter:",",speed:d,buffer:1}),g=new IntersectionObserver(t=>{t[0].intersectionRatio>=.5&&o.update(),t[0].isIntersecting&&o.update()});function p(){let e=Number(t.dataset.currentpage),a=Number(t.dataset.totalpages);if(!i)return;i.innerHTML="";let r=document.createElement("span");r.classList.add("dsm-gallery-number-pagination"),r.setAttribute("data-pagination","prev"),r.innerHTML=i.getAttribute("data-pagination-prev-text");let n=document.createElement("span");if(n.classList.add("dsm-gallery-previous-dot"),n.innerHTML="...",i.appendChild(r),c&&e>5&&i.appendChild(n),a>5&&c){let l=Array(a).fill(0).map((t,e)=>e+1),s=e>=5?l.slice(e-3,e+2):[1,2,3,4,5];s.map(t=>{let e=document.createElement("span");e.innerHTML=t,e.classList.add("dsm-gallery-number-pagination"),e.setAttribute("data-pagination",t),i.appendChild(e)})}else Array(a).fill(0).map((t,e)=>{let a=e+1,r=document.createElement("span");r.innerHTML=a,r.classList.add("dsm-gallery-number-pagination"),r.setAttribute("data-pagination",a),i.appendChild(r)});let d=document.createElement("span");d.classList.add("dsm-gallery-number-pagination"),d.setAttribute("data-pagination","next"),d.innerHTML=i.getAttribute("data-pagination-next-text");let o=document.createElement("span");o.classList.add("dsm-gallery-next-dot"),o.innerHTML="...",c&&e>5&&i.appendChild(o),i.appendChild(d),function e(){if(!i)return;let a=i.querySelectorAll(".dsm-gallery-number-pagination"),r=Number(t.dataset.currentpage)>1,n="true"===t.dataset.hasnextpage;a.forEach(e=>{isNaN(e.dataset.pagination)||n||r||(e.style.display="none"),Number(t.dataset.currentpage)===Number(e.dataset.pagination)&&e.classList.add("dsm-active-pagination-item"),e.addEventListener("click",()=>{n="true"===t.dataset.hasnextpage,a.forEach(t=>t.classList.remove("dsm-active-pagination-item"));let i=Number(t.dataset.currentpage),l=e.dataset.pagination,s=u();switch(r=i>1,l){case"next":{if(!n)return;let d=i+1;a.forEach(t=>{let e=t.dataset.pagination;d===Number(e)&&t.classList.add("dsm-active-pagination-item")}),t.setAttribute("data-currentpage",d),f(s,d)}break;case"prev":{if(!r)return;let c=i-1;a.forEach(t=>{let e=t.dataset.pagination;c===Number(e)&&t.classList.add("dsm-active-pagination-item")}),t.setAttribute("data-currentpage",c),f(s,c)}break;default:e.classList.add("dsm-active-pagination-item"),t.setAttribute("data-currentpage",l),f(s,Number(l))}})})}()}function u(){let t=Array.from(r).find(t=>t.classList.contains("dsm-active-filter"));return t&&t.hasAttribute("data-category")&&"undefined"!==t.dataset.category?t.dataset.category:"all"}function m(e){let a=t.querySelectorAll(".dsm-filterable-gallery-item"),i=Array.from(a).filter(t=>t.dataset.groups.split(",").includes(e)),r=l?n:i.length,s=function t(e,a){for(var i=[],r=0,n=e.length;r<n;)i.push(e.slice(r,r+=a));return i}(i,r);a.forEach(t=>{t.setAttribute("data-inpage","-1")}),s.forEach((t,e)=>{let a=e+1;t.forEach(t=>{t.setAttribute("data-inpage",a.toString())})}),t.setAttribute("data-totalPages",s.length);let d=t.querySelectorAll(".dsm-filterable-gallery-item"),o=Array.from(d).filter(a=>{let i=Number(a.dataset.inpage),r=a.dataset.groups.split(",").includes(e),n=Number(t.dataset.currentpage)+1;return i===n&&r}),g=Array.from(d).filter(a=>{let i=Number(a.dataset.inpage),r=a.dataset.groups.split(",").includes(e),n=Number(t.dataset.currentpage)-1;return i===n&&r}),u=o.length>0,m=g.length>0;t.setAttribute("data-hasnextpage",String(u)),t.setAttribute("data-hasPrevpage",String(m)),c&&p()}function f(e,a=t.dataset.currentpage){var i;a=Number(t.dataset.currentpage),o.filter(t=>{let i=Number(t.dataset.inpage),r=t.dataset.groups,n=("number"===s?i===a:i<=a)&&-1!==i,l=r.split(",").includes(e);return l&&n}),i=e,r.forEach(t=>{let e=t.dataset.category;i===e?t.classList.add("dsm-active-filter"):t.classList.remove("dsm-active-filter")}),m(e)}g.observe(e),r.forEach(e=>{e.addEventListener("click",()=>{let a=e.dataset.category;m(a),t.setAttribute("data-currentpage","1"),f(a),i&&p()})}),a&&a.addEventListener("click",()=>(function e(){let a=Number(t.dataset.currentpage),i=a+1,r=u();t.setAttribute("data-currentpage",i.toString()),m(r),f(r,i)})());let b=void 0!==r[0]?r[0].dataset.category:"all";m(b),f(b),p()})})});